{% extends "base.html" %}
{% block title %}Workout Page{% endblock %}
{% block header %}Workout Tracker{% endblock %}

{% block body %}
  <div class="bx">
    <form action="/workout" method="post" novalidate>
      <div class="fld">
        <label class="lb" for="w_date">Date</label>
        <svg class="ic" viewBox="0 0 24 24"><path fill="currentColor" d="M3 4h18v2H3zm18 4H3v12h18z"/></svg>
        <input class="inp" type="date" id="w_date" name="date" required>
        <div class="btn-row">
          <button class="btn-s" type="button" data-fill="today" data-target="w_date">Today</button>
          <button class="btn-s" type="button" data-fill="yesterday" data-target="w_date">Yesterday</button>
        </div>
      </div>
      <div class="fld">
        <label class="lb" for="name">Workout Name</label>
        <svg class="ic" viewBox="0 0 24 24"><path fill="currentColor" d="M7 7h10v2H7zM7 11h10v2H7zM7 15h10v2H7z"/></svg>
        <input class="inp" type="text" id="name" name="name" required>
      </div>
      <div class="fld">
        <label class="lb" for="type">Type</label>
        <input class="inp" type="text" id="type" name="type" placeholder="e.g., Cardio" required>
        <div class="chips">
          <button class="chip" type="button" data-fill="Cardio"   data-target="type">Cardio</button>
          <button class="chip" type="button" data-fill="Strength" data-target="type">Strength</button>
          <button class="chip" type="button" data-fill="HIIT"     data-target="type">HIIT</button>
          <button class="chip" type="button" data-fill="Mobility" data-target="type">Mobility</button>
        </div>
      </div>
      <div class="fld">
        <label class="lb" for="duration">Duration (min)</label>
        <svg class="ic" viewBox="0 0 24 24"><path fill="currentColor" d="M12 7v5l4 2"/></svg>
        <input class="inp" type="number" id="duration" name="duration" min="0" step="1" required>
      </div>
      <div class="fld">
        <label class="lb">Intensity</label>
        <div class="seg">
          {% for v in range(1,11) %}
            <input type="radio" id="i{{v}}" name="intensity" value="{{v}}" {% if v==7 %}checked{% endif %}>
            <label for="i{{v}}">{{v}}</label>
          {% endfor %}
        </div>
        <div class="help">Pick from 1 (easy) to 10 (max).</div>
      </div>
      <div class="fld">
        <label class="lb" for="w_rate">Workout rating (1–10)</label>
        <div class="range">
          <input type="range" id="w_rate" name="rating" min="1" max="10" step="1" value="8">
          <span class="bubble" id="w_rate_val">8</span>
        </div>
      </div>
      <div class="fld">
        <label class="lb" for="w_notes">Notes</label>
        <input class="inp" type="text" id="w_notes" name="notes" placeholder="Optional notes">
      </div>
      <button class="btnp" type="submit">Save workout</button>
    </form>
  </div>

  <!-- Chart Section -->
  <div class="chart-container" style="margin: 2rem 0; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
    <h3 class="ctr">Workout Duration Trends</h3>
    <canvas id="workoutChart" width="400" height="200"></canvas>
  </div>

  <h2 class="ctr">Recent Workout Logs</h2>
  <div class="cards">
    {% for entry in workout_data %}
      {% set rating = entry[7] or 0 %}
      {% set badge = 'r-g' if rating|int >= 8 else ('r-o' if rating|int >= 5 else 'r-r') %}
      <article class="card">
        <div class="card-hd">
          <span class="dt">{{ entry[2] }}</span>
          <span class="pill r-b {{ badge }}">Rating: {{ rating }}</span>
        </div>
        <div class="grid">
          <div class="kpi"><div class="k-l">Workout</div><div class="k-v">{{ entry[1] }}</div></div>
          <div class="kpi"><div class="k-l">Type</div><div class="k-v">{{ entry[5] }}</div></div>
          <div class="kpi"><div class="k-l">Duration (min)</div><div class="k-v">{{ entry[3] }}</div></div>
          <div class="kpi"><div class="k-l">Intensity (1–10)</div><div class="k-v">{{ entry[4] }}</div></div>
        </div>
        <div class="nts">
          <details>
            <summary>Notes</summary>
            <p>{{ entry[6] or 'No notes' }}</p>
          </details>
        </div>
      </article>
    {% endfor %}
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <script>
    // Prepare data for Chart.js
    const workoutData = JSON.parse('{{ workout_chart_data | tojson | safe }}');
    const labels = workoutData.map(entry => entry[0]); // dates
    const durations = workoutData.map(entry => parseInt(entry[1])); // workout durations
    
    const ctx = document.getElementById('workoutChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'Workout Duration (minutes)',
          data: durations,
          backgroundColor: 'rgba(34, 197, 94, 0.7)',
          borderColor: '#22c55e',
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            display: true,
            position: 'top'
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: 'Minutes'
            }
          },
          x: {
            title: {
              display: true,
              text: 'Date'
            }
          }
        }
      }
    });
  </script>
  <script>bindRange('w_rate','w_rate_val');</script>

{% endblock %}
